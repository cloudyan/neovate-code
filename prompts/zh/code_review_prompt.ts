// ä»£ç å®¡æŸ¥æç¤ºè¯æ¨¡æ¿å‡½æ•° (å¯¹åº”è‹±æ–‡åŸæ–‡ä»¶: /src/slash-commands/builtin/review.ts)
// åŸºäºé«˜è´¨é‡ç‰ˆæœ¬ï¼Œæä¾›4æ­¥ä¸“ä¸šå®¡æŸ¥æµç¨‹

export interface CodeReviewData {
  // å®¡æŸ¥å‘˜ä¸“ä¸šé¢†åŸŸ
  specialty?:
    | 'å‰ç«¯'
    | 'åç«¯'
    | 'å…¨æ ˆ'
    | 'ç§»åŠ¨ç«¯'
    | 'AI/ML'
    | 'DevOps'
    | 'å®‰å…¨'
    | 'æµ‹è¯•'
    | 'æ¶æ„';

  // æŠ€æœ¯ä¿¡æ¯
  programmingLanguage?: string;
  framework?: string; // æ¡†æ¶ä¿¡æ¯

  // ç»Ÿè®¡æ•°æ®
  added?: number;
  deleted?: number;
  filesChanged?: number; // å˜æ›´æ–‡ä»¶æ•°

  // PRä¿¡æ¯
  prNumber?: string;
  author?: string; // ä½œè€…ä¿¡æ¯
  reviewers?: string[]; // å®¡æŸ¥è€…åˆ—è¡¨

  // è´¨é‡æŒ‡æ ‡
  coverageReport?: string;
  testCoverage?: number; // è¦†ç›–ç‡ç™¾åˆ†æ¯”
  complexityScore?: number; // å¤æ‚åº¦è¯„åˆ†

  // é…ç½®é€‰é¡¹
  language?: 'ä¸­æ–‡' | 'è‹±æ–‡';
  severityThreshold?: 'ä½' | 'ä¸­' | 'é«˜'; // ä¸¥é‡ç¨‹åº¦é˜ˆå€¼
  maxIssues?: number; // æœ€å¤§é—®é¢˜æ•°

  // é£æ ¼æŒ‡å—
  styleGuideUrl?: string;
}

export function codeReviewPrompt(data: CodeReviewData) {
  // å‚æ•°è§£æ„å’Œé»˜è®¤å€¼
  const {
    specialty = 'å…¨æ ˆ',
    programmingLanguage,
    framework,
    added = 0,
    deleted = 0,
    filesChanged = 0,
    prNumber,
    author,
    reviewers = [],
    coverageReport,
    testCoverage,
    complexityScore,
    language = 'ä¸­æ–‡',
    severityThreshold = 'ä¸­',
    maxIssues = 10,
    styleGuideUrl,
  } = data;

  return `
# ğŸ“‹ ä»£ç å®¡æŸ¥ä»»åŠ¡ - ${specialty}ä¸“å®¶

## ğŸš¨ é‡è¦æŒ‡ä»¤
- **ä¸¥æ ¼æŒ‰ç…§4æ­¥æ‰§è¡Œï¼Œä¸å¾—è·³è¿‡æˆ–è°ƒæ•´é¡ºåº**
- **æ¯æ­¥å®Œæˆåå¿…é¡»ç¡®è®¤å†è¿›è¡Œä¸‹ä¸€æ­¥**
- **å®‰å…¨çº¢çº¿è§¦å‘æ—¶ç«‹å³åœæ­¢ï¼Œè¾“å‡º"## ğŸš¨ å®‰å…¨é˜»æ–­"**
- **ä»…è¾“å‡ºæŒ‡å®šæ ¼å¼ï¼Œç¦æ­¢ä»»ä½•é¢å¤–è§£é‡Šæˆ–æ ¼å¼**

---

## æ­¥éª¤1ï¼šè·å–å·®å¼‚
${
  prNumber
    ? `æ‰§è¡Œï¼šbash("gh pr diff ${prNumber}")`
    : `æ‰§è¡Œï¼šbash("git --no-pager diff --cached -- .")`
}

---

## æ­¥éª¤2ï¼šå®‰å…¨çº¢çº¿æ£€æŸ¥

### ğŸš¨ é«˜å±æ¼æ´ï¼ˆç«‹å³é˜»æ–­ï¼‰
- **æ³¨å…¥æ”»å‡»**ï¼šSQLæ³¨å…¥ã€NoSQLæ³¨å…¥ã€å‘½ä»¤æ³¨å…¥ã€ä»£ç æ³¨å…¥ã€LDAPæ³¨å…¥
- **å¯†é’¥æ³„éœ²**ï¼šç¡¬ç¼–ç å¯†é’¥ã€APIå¯†é’¥ã€è¯ä¹¦ã€å¯†ç ã€Token
- **è·¯å¾„å®‰å…¨**ï¼šè·¯å¾„ç©¿è¶Šã€æ–‡ä»¶åŒ…å«æ¼æ´ã€ç›®å½•éå†
- **ååºåˆ—åŒ–**ï¼šä¸å®‰å…¨çš„ååºåˆ—åŒ–ã€XXEæ”»å‡»
- **è®¤è¯æˆæƒ**ï¼šæƒé™ç»•è¿‡ã€èº«ä»½è®¤è¯ç¼ºé™·ã€ä¼šè¯ç®¡ç†é—®é¢˜

### âš ï¸ ä¸­å±é£é™©ï¼ˆè®°å½•ä½†ç»§ç»­ï¼‰
- **XSSç›¸å…³**ï¼šåå°„å‹XSSã€å­˜å‚¨å‹XSSã€DOMå‹XSS
- **CSRF/SSRF**ï¼šè·¨ç«™è¯·æ±‚ä¼ªé€ ã€æœåŠ¡ç«¯è¯·æ±‚ä¼ªé€ 
- **ä¿¡æ¯æ³„éœ²**ï¼šæ•æ„Ÿä¿¡æ¯æš´éœ²ã€è°ƒè¯•ä¿¡æ¯æ³„éœ²
- **åŠ å¯†é—®é¢˜**ï¼šå¼±åŠ å¯†ç®—æ³•ã€ä¸å®‰å…¨çš„éšæœºæ•°ç”Ÿæˆ

---

## æ­¥éª¤3ï¼šä»£ç è´¨é‡å®¡æŸ¥

### ğŸ¯ å®¡æŸ¥é‡ç‚¹
- **ä»£ç é€»è¾‘**ï¼šç®—æ³•æ•ˆç‡ã€è¾¹ç•Œæ¡ä»¶ã€é”™è¯¯å¤„ç†ã€å¼‚å¸¸ç®¡ç†
- **æ¶æ„è®¾è®¡**ï¼šæ¨¡å—è€¦åˆã€æ¥å£è®¾è®¡ã€æ‰©å±•æ€§ã€å¯ç»´æŠ¤æ€§
- **æ€§èƒ½å½±å“**ï¼šæ—¶é—´å¤æ‚åº¦ã€å†…å­˜ä½¿ç”¨ã€å¹¶å‘å®‰å…¨ã€èµ„æºç®¡ç†
- **æµ‹è¯•è¦†ç›–**ï¼šå•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€è¾¹ç•Œæµ‹è¯•ã€å¼‚å¸¸æµ‹è¯•
- **æ–‡æ¡£å®Œæ•´æ€§**ï¼šæ³¨é‡Šè´¨é‡ã€APIæ–‡æ¡£ã€å˜æ›´æ—¥å¿—ã€README

### ğŸ“Š é—®é¢˜åˆ†çº§æ ‡å‡†
- **ä¸¥é‡**ï¼šå®‰å…¨æ¼æ´ã€åŠŸèƒ½é”™è¯¯ã€æ€§èƒ½ç“¶é¢ˆã€æ•°æ®ä¸¢å¤±é£é™©
- **é‡è¦**ï¼šä»£ç å¼‚å‘³ã€è®¾è®¡ç¼ºé™·ã€æµ‹è¯•ç¼ºå¤±ã€æ€§èƒ½é—®é¢˜
- **ä¸€èˆ¬**ï¼šé£æ ¼é—®é¢˜ã€å‘½åè§„èŒƒã€æ³¨é‡Šä¸è¶³ã€ä»£ç æ ¼å¼

---

## æ­¥éª¤4ï¼šç»“æ„åŒ–è¾“å‡º

\`\`\`markdown
## ğŸ“Š è¯„å®¡æ€»ç»“
- **å˜æ›´è§„æ¨¡**: ${added} å¢ / ${deleted} åˆ  (æ¶‰åŠ ${filesChanged} ä¸ªæ–‡ä»¶)
- **é£é™©ç­‰çº§**: ä½ | ä¸­ | é«˜ | ä¸¥é‡
- **è¯„å®¡ç»“è®º**: âœ… é€šè¿‡ | âš ï¸ è¦æ±‚ä¿®æ”¹ | âŒ å®‰å…¨é˜»æ–­
- **æµ‹è¯•è¦†ç›–**: ${testCoverage ? `${testCoverage}%` : coverageReport ? 'å·²æä¾›' : 'æœªæä¾›'}
- **å¤æ‚åº¦è¯„åˆ†**: ${complexityScore || 'æœªè¯„ä¼°'}

## ğŸš¨ é—®é¢˜åˆ—è¡¨
| æ–‡ä»¶è·¯å¾„ | è¡Œå· | ä¸¥é‡ç¨‹åº¦ | é—®é¢˜ç±»å‹ | é—®é¢˜æè¿° | ä¿®æ”¹å»ºè®® |
|----------|------|----------|----------|----------|----------|
| src/api/auth.ts | 45 | ä¸¥é‡ | å®‰å…¨æ¼æ´ | SQLæ³¨å…¥é£é™© | ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ |
| ... | ... | ... | ... | ... | ... |

## âœ¨ äº®ç‚¹è¡¨æ‰¬
1. [å…·ä½“ä¼˜ç‚¹1] - [ä½ç½®å’ŒåŸå› ]
2. [å…·ä½“ä¼˜ç‚¹2] - [ä½ç½®å’ŒåŸå› ]
3. [å…·ä½“ä¼˜ç‚¹3] - [ä½ç½®å’ŒåŸå› ]

## ğŸ“‹ å…·ä½“å»ºè®®
- [ ] ä¿®å¤å®‰å…¨æ¼æ´
- [ ] è¡¥å……å•å…ƒæµ‹è¯•
- [ ] ä¼˜åŒ–æ€§èƒ½ç“¶é¢ˆ
- [ ] å®Œå–„æ–‡æ¡£æ³¨é‡Š
- [ ] è°ƒæ•´ä»£ç ç»“æ„
\`\`\`

---

## ğŸ“ è¾“å‡ºè§„èŒƒ
- **ä¸¥æ ¼æ ¼å¼**ï¼šå®Œå…¨æŒ‰ç…§æ¨¡æ¿è¾“å‡ºï¼Œä¸å¾—ä¿®æ”¹æ ¼å¼
- **å­—æ•°é™åˆ¶**ï¼šæ¯æ ¼â‰¤30å­—ï¼Œé—®é¢˜æè¿°â‰¤20å­—ï¼Œä¿®æ”¹å»ºè®®â‰¤25å­—
- **è¡Œå·ç²¾ç¡®**ï¼šæä¾›GitHubå¯ç‚¹å‡»çš„è¡Œå·æ ¼å¼
- **æ•°é‡æ§åˆ¶**ï¼šæœ€å¤š${maxIssues}ä¸ªé—®é¢˜ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰
- **ä¸¥é‡ç¨‹åº¦é˜ˆå€¼**ï¼šä»…æŠ¥å‘Šâ‰¥${severityThreshold}ä¸¥é‡ç¨‹åº¦çš„é—®é¢˜

---

## ğŸ¯ å®¡æŸ¥æ ‡å‡†
${programmingLanguage ? `- **æŠ€æœ¯æ ˆ**: ${programmingLanguage}` : ''}
${framework ? `- **æ¡†æ¶**: ${framework}` : ''}
${styleGuideUrl ? `- **é£æ ¼æŒ‡å—**: ${styleGuideUrl}` : ''}
${testCoverage ? `- **è¦†ç›–ç‡è¦æ±‚**: â‰¥80% (å½“å‰: ${testCoverage}%)` : '- **è¦†ç›–ç‡è¦æ±‚**: â‰¥80%'}
- **å®¡æŸ¥è¯­è¨€**: ${language}
- **ä¸¥é‡ç¨‹åº¦é˜ˆå€¼**: ${severityThreshold}
- **æœ€å¤§é—®é¢˜æ•°**: ${maxIssues}

---

## ğŸ“ é¡¹ç›®ä¿¡æ¯
- **PRç¼–å·**: ${prNumber || 'æœ¬åœ°æäº¤'}
- **ä½œè€…**: ${author || 'æœªçŸ¥'}
- **å®¡æŸ¥è€…**: ${reviewers.length > 0 ? reviewers.join(', ') : 'æœªæŒ‡å®š'}
- **ç”Ÿæˆæ—¶é—´**: ${new Date().toISOString()}
  `.trim();
}
